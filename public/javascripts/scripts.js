$(function(){var e=!0;function r(){$("form.login p.error, form.register p.error").remove(),$("form.login input, form.register input").removeClass("error")}$(".switch-button").on("click",function(o){o.preventDefault(),$("input").val(""),r(),e?(e=!1,$(".register").show("slow"),$(".login").hide()):(e=!0,$(".login").show("slow"),$(".register").hide())}),$("form.login input, form.register input").on("focus",r),$(".register-button").on("click",function(o){o.preventDefault(),r();var e={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-password-comfirm").val()};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/api/auth/register"}).done(function(o){o.ok?$(location).attr("href","/"):($(".register h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})}),$(".login-button").on("click",function(o){o.preventDefault(),r();var e={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/api/auth/logging"}).done(function(o){o.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})})}),$(function(){function r(){$(".add-post p.error").remove(),$("#post-title, #post-body").removeClass("error")}new MediumEditor("#post-body",{placeholder:{text:"",hideOnClick:!0}});$(".add-post input, #post-body").on("focus",r),$(".publish-button").on("click",function(o){o.preventDefault(),r();var e={title:$("#post-title").val(),body:$("#post-body").html()};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/posts/add"}).done(function(o){o.ok?$(location).attr("href","/"):($(".add-post h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){console.log("#post-"+o),$("#post-"+o).addClass("error")}))})}),$(".post .body .mainView").on("click",function(o){o.preventDefault(),$(".post .body .mainView").removeClass("mainView")})}),$(function(){var t,n;function i(o,e){if($(".reply").show(),t&&t.remove(),n=null,t=$("form.comment").clone(!0,!0),o)t.find(".cancel").hide(),t.appendTo(".comment-list");else{var r=$(e).parent();n=r.attr("id"),$(e).after(t)}t.css({display:"flex"})}i(!0),$(".reply").on("click",function(o){i(!1,this),$(this).hide()}),$("form.comment .cancel").on("click",function(o){o.preventDefault(),t.remove(),i(!0)}),$("form.comment .send").on("click",function(o){o.preventDefault();var r={post:$(".comments").attr("id"),body:t.find("textarea").val(),parent:n};$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/comment/add"}).done(function(o){if(o.ok){var e='<ul id="newComment"><li style="background-color: #ffffe0;" id="'+r.post+'"><div class="head"><a href="/users/'+o.owner+'">'+o.owner+'</a><span class="date">Только что</span></div>'+r.body+"</li></ul>";$(t).after(e),i(!0)}else void 0===o.error&&(o.error="Неизвестная ошибка"),$(t).prepend('<p class="error">'+o.error+"</p>"),o.fields&&r.fields.forEach(function(o){$("#post-"+o).addClass("error")})})})});